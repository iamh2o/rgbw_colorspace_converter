<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>pyramidtriangles.grid.geom API documentation</title>
<meta name="description" content="This package contains classes for triangle geometry, doing math for positioning within a triangle
panel&#39;s cells and DMX universes. They are all …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pyramidtriangles.grid.geom</code></h1>
</header>
<section id="section-intro">
<p>This package contains classes for triangle geometry, doing math for positioning within a triangle
panel's cells and DMX universes. They are all immutable dataclasses, which amount to tuples with
functions.</p>
<p>Coordinate(x,y) and Position(row,col) are two ways to give a location of a cell in a triangle.
They are different but can both express location equally.</p>
<p>Universe(base,id) is a DMX universe. Each triangle panels contains multiple DMX universes. The
first DMX universe of a panel is the base. DMX universes do not span multiple triangle panels.</p>
<p>Address(universe,offset) is a specific offset within a DMX universe. Models (sACN) send color
data to a specific Address.</p>
<p>Geometry(origin,rows) is a conceptual geometry that can represent either a single triangle or
a larger side of the pyramid. A side of the pyramid contains multiple triangles with empty space
between them.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
This package contains classes for triangle geometry, doing math for positioning within a triangle
panel&#39;s cells and DMX universes. They are all immutable dataclasses, which amount to tuples with
functions.

Coordinate(x,y) and Position(row,col) are two ways to give a location of a cell in a triangle.
They are different but can both express location equally.

Universe(base,id) is a DMX universe. Each triangle panels contains multiple DMX universes. The
first DMX universe of a panel is the base. DMX universes do not span multiple triangle panels.

Address(universe,offset) is a specific offset within a DMX universe. Models (sACN) send color
data to a specific Address.

Geometry(origin,rows) is a conceptual geometry that can represent either a single triangle or
a larger side of the pyramid. A side of the pyramid contains multiple triangles with empty space
between them.
&#34;&#34;&#34;
from __future__ import annotations
from functools import lru_cache
from typing import NamedTuple, Union


class Position(NamedTuple):
    &#34;&#34;&#34;
    Position is (row, column) where the top row is 0, and every row begins with column 0.
    Position(0, 0) is the apex of the triangle.

    Prefer to use Coordinate, which is (x, y) such that the left-most, bottom triangle is (0, 0).
    &#34;&#34;&#34;
    row: int
    col: int

    @classmethod
    @lru_cache(maxsize=512)
    def from_id(cls, id: int) -&gt; Position:
        row_below = 1
        while Geometry.triangular_number(row_below) &lt;= id:
            row_below += 1

        row = row_below - 1
        col = id - Geometry.triangular_number(row)
        return Position(row, col)

    @property
    def id(self) -&gt; int:
        return Geometry.triangular_number(self.row) + self.col

    def adjust(self, row: int = 0, col: int = 0) -&gt; Position:
        return Position(self.row + row, self.col + col)

    def __add__(self, other: Position) -&gt; Position:
        if not isinstance(other, Position):
            raise TypeError(&#39;invalid: %r + %r&#39; % (self, other))

        return Position(self.row + other.row, self.col + other.col)


class Coordinate(NamedTuple):
    &#34;&#34;&#34;
    Coordinate is (x, y) such that the left-most, bottom triangle is (0, 0).

    For Coordinate(x, y), the triangle above is Coordinate(x, y + 1), left is Coordinate(x - 1, y), below is
    Coordinate(x, y - 1), and right is Coordinate(x + 1, y).

    Coordinate differs from `Position`. Position(0, 0) is the apex of the whole triangle, whereas Coordinate(0, 0)
    refers to the left corner.

    Coordinates are a different way to spatially reason than Position.
    &#34;&#34;&#34;

    x: int
    y: int

    @classmethod
    @lru_cache(maxsize=2048)
    def from_pos(cls, pos: Position, geom: Geometry) -&gt; Coordinate:
        y = geom.rows - 1 - pos.row
        x = pos.col + y
        return Coordinate(x, y)

    def pos(self, geom: Geometry):
        return Position(geom.rows - 1 - self.y, self.x - self.y)

    def adjust(self, x: int = 0, y: int = 0) -&gt; Coordinate:
        return Coordinate(self.x + x, self.y + y)

    def __str__(self) -&gt; str:
        return f&#39;&lt;{self.x}, {self.y}&gt;&#39;


CHANNELS_PER_PIXEL: int = 4  # R, G, B, W


class Universe(NamedTuple):
    &#34;&#34;&#34;
    Universe is a DMX universe.

    The base gives the universe ID of the first universe of a panel.
    (This is used for the universe-length arithmetic.)
    &#34;&#34;&#34;

    base: int
    id: int

    @property
    def size(self) -&gt; int:
        &#34;&#34;&#34;
        Gives the number of connected channels in each DMX universe.

        Every third universe in a panel is shorter. (Also, not all channels
        are visible; some correspond to the strip segments between rows.)
        &#34;&#34;&#34;

        return 512 if (self.id - (self.base - 1)) % 3 != 0 else (44 * 4)

    @property
    def next(self) -&gt; Universe:
        return Universe(self.base, self.id + 1)


class Address(NamedTuple):
    &#34;&#34;&#34;
    Address refers to a cell&#39;s DMX address within one of the triangle panels.
    &#34;&#34;&#34;

    universe: Universe
    offset: int

    @classmethod
    def first(cls, universe: Universe = Universe(1, 1), offset: int = 4):
        return Address(universe=universe, offset=offset)

    @property
    def next(self) -&gt; Address:
        next_offset = self.offset + CHANNELS_PER_PIXEL
        if next_offset &gt;= self.universe.size:
            return Address(self.universe.next, 0)

        return Address(self.universe, next_offset)

    def skip(self, n: int) -&gt; Address:
        addr = self
        for _ in range(n):
            addr = addr.next

        return addr

    def range(self, len: int) -&gt; list[Address]:
        addrs = [self]
        for _ in range(len - 1):
            addrs.append(addrs[-1].next)

        return addrs

    def __str__(self) -&gt; str:
        return f&#39;{self.universe}:{self.offset}&#39;


class Geometry(NamedTuple):
    &#34;&#34;&#34;
    Geometry represents the dimensions of a panel or side of the pyramid.
    &#34;&#34;&#34;

    origin: Coordinate  # bottom-leftmost cell coordinate
    rows: int

    def __contains__(self, loc: Union[Coordinate, Position]) -&gt; bool:
        &#34;&#34;&#34;
        Returns if a Coordinate or Position fits within the geometry.

        For example:

        if Coordinate(9, 8) in Geometry(origin=Coordinate(0,0), rows=11):
            print(&#34;(x=9,y=8) is within the triangle&#34;)
        &#34;&#34;&#34;
        if isinstance(loc, Coordinate):
            if loc.x &lt; 0 or loc.y &lt; 0:
                return False
            coord = loc
        elif isinstance(loc, Position):
            if loc.row &lt; 0 or loc.col &lt; 0:
                return False
            coord = Coordinate.from_pos(loc, self)
        else:
            raise TypeError(
                f&#39;`{loc!r} in Geometry` is invalid (not a Coordinate or a Position)&#39;)

        # convert to relative coordinate
        rel = Coordinate(coord.x - self.origin.x, coord.y - self.origin.y)
        rel_pos = rel.pos(self)

        try:
            return (0 &lt;= rel_pos.col &lt; self.row_length(rel_pos.row) and
                    0 &lt;= rel_pos.row &lt; self.rows)
        except IndexError:
            return False

    def row_length(self, n: int) -&gt; int:
        if n &lt; 0 or n &gt;= self.rows:
            raise IndexError(f&#39;row {n} out of range ({self.rows} rows total)&#39;)

        return (n + 1) * 2 - 1

    def midpoint(self, row: int) -&gt; int:
        length = self.row_length(row)
        return int(length - (length / 2))

    @property
    def height(self) -&gt; int:
        return self.rows

    @property
    def width(self) -&gt; int:
        return self.row_length(self.rows - 1)

    @property
    def cell_count(self) -&gt; int:
        return sum(self.row_length(i) for i in range(self.rows))

    @property
    def apex(self) -&gt; Coordinate:
        &#34;&#34;&#34;
        The &lt;x, y&gt; coordinate of the top of the triangle.
        &#34;&#34;&#34;
        return Coordinate(self.origin.x + self.midpoint(self.rows - 1),
                          self.origin.y + (self.rows - 1))

    @staticmethod
    def triangular_number(n: int) -&gt; int:
        &#34;&#34;&#34;Returns the number of elements in an equilateral triangle of n rows.&#34;&#34;&#34;
        # Typically the triangle number is (n(n+1))/2 but our triangle has rows of 1, 3, 5...
        return n ** 2</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="pyramidtriangles.grid.geom.Address"><code class="flex name class">
<span>class <span class="ident">Address</span></span>
<span>(</span><span>universe: ForwardRef('<a title="pyramidtriangles.grid.geom.Universe" href="#pyramidtriangles.grid.geom.Universe">Universe</a>'), offset: ForwardRef('int'))</span>
</code></dt>
<dd>
<div class="desc"><p>Address refers to a cell's DMX address within one of the triangle panels.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Address(NamedTuple):
    &#34;&#34;&#34;
    Address refers to a cell&#39;s DMX address within one of the triangle panels.
    &#34;&#34;&#34;

    universe: Universe
    offset: int

    @classmethod
    def first(cls, universe: Universe = Universe(1, 1), offset: int = 4):
        return Address(universe=universe, offset=offset)

    @property
    def next(self) -&gt; Address:
        next_offset = self.offset + CHANNELS_PER_PIXEL
        if next_offset &gt;= self.universe.size:
            return Address(self.universe.next, 0)

        return Address(self.universe, next_offset)

    def skip(self, n: int) -&gt; Address:
        addr = self
        for _ in range(n):
            addr = addr.next

        return addr

    def range(self, len: int) -&gt; list[Address]:
        addrs = [self]
        for _ in range(len - 1):
            addrs.append(addrs[-1].next)

        return addrs

    def __str__(self) -&gt; str:
        return f&#39;{self.universe}:{self.offset}&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Address.first"><code class="name flex">
<span>def <span class="ident">first</span></span>(<span>universe: <a title="pyramidtriangles.grid.geom.Universe" href="#pyramidtriangles.grid.geom.Universe">Universe</a> = Universe(base=1, id=1), offset: int = 4)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@classmethod
def first(cls, universe: Universe = Universe(1, 1), offset: int = 4):
    return Address(universe=universe, offset=offset)</code></pre>
</details>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Address.next"><code class="name">var <span class="ident">next</span> : <a title="pyramidtriangles.grid.geom.Address" href="#pyramidtriangles.grid.geom.Address">Address</a></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def next(self) -&gt; Address:
    next_offset = self.offset + CHANNELS_PER_PIXEL
    if next_offset &gt;= self.universe.size:
        return Address(self.universe.next, 0)

    return Address(self.universe, next_offset)</code></pre>
</details>
</dd>
<dt id="pyramidtriangles.grid.geom.Address.offset"><code class="name">var <span class="ident">offset</span> : int</code></dt>
<dd>
<div class="desc"><p>Alias for field number 1</p></div>
</dd>
<dt id="pyramidtriangles.grid.geom.Address.universe"><code class="name">var <span class="ident">universe</span> : <a title="pyramidtriangles.grid.geom.Universe" href="#pyramidtriangles.grid.geom.Universe">Universe</a></code></dt>
<dd>
<div class="desc"><p>Alias for field number 0</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Address.range"><code class="name flex">
<span>def <span class="ident">range</span></span>(<span>self, len: int) ‑> list</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def range(self, len: int) -&gt; list[Address]:
    addrs = [self]
    for _ in range(len - 1):
        addrs.append(addrs[-1].next)

    return addrs</code></pre>
</details>
</dd>
<dt id="pyramidtriangles.grid.geom.Address.skip"><code class="name flex">
<span>def <span class="ident">skip</span></span>(<span>self, n: int) ‑> <a title="pyramidtriangles.grid.geom.Address" href="#pyramidtriangles.grid.geom.Address">Address</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def skip(self, n: int) -&gt; Address:
    addr = self
    for _ in range(n):
        addr = addr.next

    return addr</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="pyramidtriangles.grid.geom.Coordinate"><code class="flex name class">
<span>class <span class="ident">Coordinate</span></span>
<span>(</span><span>x: ForwardRef('int'), y: ForwardRef('int'))</span>
</code></dt>
<dd>
<div class="desc"><p>Coordinate is (x, y) such that the left-most, bottom triangle is (0, 0).</p>
<p>For Coordinate(x, y), the triangle above is Coordinate(x, y + 1), left is Coordinate(x - 1, y), below is
Coordinate(x, y - 1), and right is Coordinate(x + 1, y).</p>
<p>Coordinate differs from <code><a title="pyramidtriangles.grid.geom.Position" href="#pyramidtriangles.grid.geom.Position">Position</a></code>. Position(0, 0) is the apex of the whole triangle, whereas Coordinate(0, 0)
refers to the left corner.</p>
<p>Coordinates are a different way to spatially reason than Position.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Coordinate(NamedTuple):
    &#34;&#34;&#34;
    Coordinate is (x, y) such that the left-most, bottom triangle is (0, 0).

    For Coordinate(x, y), the triangle above is Coordinate(x, y + 1), left is Coordinate(x - 1, y), below is
    Coordinate(x, y - 1), and right is Coordinate(x + 1, y).

    Coordinate differs from `Position`. Position(0, 0) is the apex of the whole triangle, whereas Coordinate(0, 0)
    refers to the left corner.

    Coordinates are a different way to spatially reason than Position.
    &#34;&#34;&#34;

    x: int
    y: int

    @classmethod
    @lru_cache(maxsize=2048)
    def from_pos(cls, pos: Position, geom: Geometry) -&gt; Coordinate:
        y = geom.rows - 1 - pos.row
        x = pos.col + y
        return Coordinate(x, y)

    def pos(self, geom: Geometry):
        return Position(geom.rows - 1 - self.y, self.x - self.y)

    def adjust(self, x: int = 0, y: int = 0) -&gt; Coordinate:
        return Coordinate(self.x + x, self.y + y)

    def __str__(self) -&gt; str:
        return f&#39;&lt;{self.x}, {self.y}&gt;&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Coordinate.from_pos"><code class="name flex">
<span>def <span class="ident">from_pos</span></span>(<span>cls, pos: <a title="pyramidtriangles.grid.geom.Position" href="#pyramidtriangles.grid.geom.Position">Position</a>, geom: <a title="pyramidtriangles.grid.geom.Geometry" href="#pyramidtriangles.grid.geom.Geometry">Geometry</a>) ‑> <a title="pyramidtriangles.grid.geom.Coordinate" href="#pyramidtriangles.grid.geom.Coordinate">Coordinate</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@classmethod
@lru_cache(maxsize=2048)
def from_pos(cls, pos: Position, geom: Geometry) -&gt; Coordinate:
    y = geom.rows - 1 - pos.row
    x = pos.col + y
    return Coordinate(x, y)</code></pre>
</details>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Coordinate.x"><code class="name">var <span class="ident">x</span> : int</code></dt>
<dd>
<div class="desc"><p>Alias for field number 0</p></div>
</dd>
<dt id="pyramidtriangles.grid.geom.Coordinate.y"><code class="name">var <span class="ident">y</span> : int</code></dt>
<dd>
<div class="desc"><p>Alias for field number 1</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Coordinate.adjust"><code class="name flex">
<span>def <span class="ident">adjust</span></span>(<span>self, x: int = 0, y: int = 0) ‑> <a title="pyramidtriangles.grid.geom.Coordinate" href="#pyramidtriangles.grid.geom.Coordinate">Coordinate</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def adjust(self, x: int = 0, y: int = 0) -&gt; Coordinate:
    return Coordinate(self.x + x, self.y + y)</code></pre>
</details>
</dd>
<dt id="pyramidtriangles.grid.geom.Coordinate.pos"><code class="name flex">
<span>def <span class="ident">pos</span></span>(<span>self, geom: <a title="pyramidtriangles.grid.geom.Geometry" href="#pyramidtriangles.grid.geom.Geometry">Geometry</a>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def pos(self, geom: Geometry):
    return Position(geom.rows - 1 - self.y, self.x - self.y)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="pyramidtriangles.grid.geom.Geometry"><code class="flex name class">
<span>class <span class="ident">Geometry</span></span>
<span>(</span><span>origin: ForwardRef('<a title="pyramidtriangles.grid.geom.Coordinate" href="#pyramidtriangles.grid.geom.Coordinate">Coordinate</a>'), rows: ForwardRef('int'))</span>
</code></dt>
<dd>
<div class="desc"><p>Geometry represents the dimensions of a panel or side of the pyramid.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Geometry(NamedTuple):
    &#34;&#34;&#34;
    Geometry represents the dimensions of a panel or side of the pyramid.
    &#34;&#34;&#34;

    origin: Coordinate  # bottom-leftmost cell coordinate
    rows: int

    def __contains__(self, loc: Union[Coordinate, Position]) -&gt; bool:
        &#34;&#34;&#34;
        Returns if a Coordinate or Position fits within the geometry.

        For example:

        if Coordinate(9, 8) in Geometry(origin=Coordinate(0,0), rows=11):
            print(&#34;(x=9,y=8) is within the triangle&#34;)
        &#34;&#34;&#34;
        if isinstance(loc, Coordinate):
            if loc.x &lt; 0 or loc.y &lt; 0:
                return False
            coord = loc
        elif isinstance(loc, Position):
            if loc.row &lt; 0 or loc.col &lt; 0:
                return False
            coord = Coordinate.from_pos(loc, self)
        else:
            raise TypeError(
                f&#39;`{loc!r} in Geometry` is invalid (not a Coordinate or a Position)&#39;)

        # convert to relative coordinate
        rel = Coordinate(coord.x - self.origin.x, coord.y - self.origin.y)
        rel_pos = rel.pos(self)

        try:
            return (0 &lt;= rel_pos.col &lt; self.row_length(rel_pos.row) and
                    0 &lt;= rel_pos.row &lt; self.rows)
        except IndexError:
            return False

    def row_length(self, n: int) -&gt; int:
        if n &lt; 0 or n &gt;= self.rows:
            raise IndexError(f&#39;row {n} out of range ({self.rows} rows total)&#39;)

        return (n + 1) * 2 - 1

    def midpoint(self, row: int) -&gt; int:
        length = self.row_length(row)
        return int(length - (length / 2))

    @property
    def height(self) -&gt; int:
        return self.rows

    @property
    def width(self) -&gt; int:
        return self.row_length(self.rows - 1)

    @property
    def cell_count(self) -&gt; int:
        return sum(self.row_length(i) for i in range(self.rows))

    @property
    def apex(self) -&gt; Coordinate:
        &#34;&#34;&#34;
        The &lt;x, y&gt; coordinate of the top of the triangle.
        &#34;&#34;&#34;
        return Coordinate(self.origin.x + self.midpoint(self.rows - 1),
                          self.origin.y + (self.rows - 1))

    @staticmethod
    def triangular_number(n: int) -&gt; int:
        &#34;&#34;&#34;Returns the number of elements in an equilateral triangle of n rows.&#34;&#34;&#34;
        # Typically the triangle number is (n(n+1))/2 but our triangle has rows of 1, 3, 5...
        return n ** 2</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Geometry.triangular_number"><code class="name flex">
<span>def <span class="ident">triangular_number</span></span>(<span>n: int) ‑> int</span>
</code></dt>
<dd>
<div class="desc"><p>Returns the number of elements in an equilateral triangle of n rows.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def triangular_number(n: int) -&gt; int:
    &#34;&#34;&#34;Returns the number of elements in an equilateral triangle of n rows.&#34;&#34;&#34;
    # Typically the triangle number is (n(n+1))/2 but our triangle has rows of 1, 3, 5...
    return n ** 2</code></pre>
</details>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Geometry.apex"><code class="name">var <span class="ident">apex</span> : <a title="pyramidtriangles.grid.geom.Coordinate" href="#pyramidtriangles.grid.geom.Coordinate">Coordinate</a></code></dt>
<dd>
<div class="desc"><p>The <x, y> coordinate of the top of the triangle.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def apex(self) -&gt; Coordinate:
    &#34;&#34;&#34;
    The &lt;x, y&gt; coordinate of the top of the triangle.
    &#34;&#34;&#34;
    return Coordinate(self.origin.x + self.midpoint(self.rows - 1),
                      self.origin.y + (self.rows - 1))</code></pre>
</details>
</dd>
<dt id="pyramidtriangles.grid.geom.Geometry.cell_count"><code class="name">var <span class="ident">cell_count</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def cell_count(self) -&gt; int:
    return sum(self.row_length(i) for i in range(self.rows))</code></pre>
</details>
</dd>
<dt id="pyramidtriangles.grid.geom.Geometry.height"><code class="name">var <span class="ident">height</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def height(self) -&gt; int:
    return self.rows</code></pre>
</details>
</dd>
<dt id="pyramidtriangles.grid.geom.Geometry.origin"><code class="name">var <span class="ident">origin</span> : <a title="pyramidtriangles.grid.geom.Coordinate" href="#pyramidtriangles.grid.geom.Coordinate">Coordinate</a></code></dt>
<dd>
<div class="desc"><p>Alias for field number 0</p></div>
</dd>
<dt id="pyramidtriangles.grid.geom.Geometry.rows"><code class="name">var <span class="ident">rows</span> : int</code></dt>
<dd>
<div class="desc"><p>Alias for field number 1</p></div>
</dd>
<dt id="pyramidtriangles.grid.geom.Geometry.width"><code class="name">var <span class="ident">width</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def width(self) -&gt; int:
    return self.row_length(self.rows - 1)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Geometry.midpoint"><code class="name flex">
<span>def <span class="ident">midpoint</span></span>(<span>self, row: int) ‑> int</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def midpoint(self, row: int) -&gt; int:
    length = self.row_length(row)
    return int(length - (length / 2))</code></pre>
</details>
</dd>
<dt id="pyramidtriangles.grid.geom.Geometry.row_length"><code class="name flex">
<span>def <span class="ident">row_length</span></span>(<span>self, n: int) ‑> int</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def row_length(self, n: int) -&gt; int:
    if n &lt; 0 or n &gt;= self.rows:
        raise IndexError(f&#39;row {n} out of range ({self.rows} rows total)&#39;)

    return (n + 1) * 2 - 1</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="pyramidtriangles.grid.geom.Position"><code class="flex name class">
<span>class <span class="ident">Position</span></span>
<span>(</span><span>row: ForwardRef('int'), col: ForwardRef('int'))</span>
</code></dt>
<dd>
<div class="desc"><p>Position is (row, column) where the top row is 0, and every row begins with column 0.
Position(0, 0) is the apex of the triangle.</p>
<p>Prefer to use Coordinate, which is (x, y) such that the left-most, bottom triangle is (0, 0).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Position(NamedTuple):
    &#34;&#34;&#34;
    Position is (row, column) where the top row is 0, and every row begins with column 0.
    Position(0, 0) is the apex of the triangle.

    Prefer to use Coordinate, which is (x, y) such that the left-most, bottom triangle is (0, 0).
    &#34;&#34;&#34;
    row: int
    col: int

    @classmethod
    @lru_cache(maxsize=512)
    def from_id(cls, id: int) -&gt; Position:
        row_below = 1
        while Geometry.triangular_number(row_below) &lt;= id:
            row_below += 1

        row = row_below - 1
        col = id - Geometry.triangular_number(row)
        return Position(row, col)

    @property
    def id(self) -&gt; int:
        return Geometry.triangular_number(self.row) + self.col

    def adjust(self, row: int = 0, col: int = 0) -&gt; Position:
        return Position(self.row + row, self.col + col)

    def __add__(self, other: Position) -&gt; Position:
        if not isinstance(other, Position):
            raise TypeError(&#39;invalid: %r + %r&#39; % (self, other))

        return Position(self.row + other.row, self.col + other.col)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Position.from_id"><code class="name flex">
<span>def <span class="ident">from_id</span></span>(<span>cls, id: int) ‑> <a title="pyramidtriangles.grid.geom.Position" href="#pyramidtriangles.grid.geom.Position">Position</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@classmethod
@lru_cache(maxsize=512)
def from_id(cls, id: int) -&gt; Position:
    row_below = 1
    while Geometry.triangular_number(row_below) &lt;= id:
        row_below += 1

    row = row_below - 1
    col = id - Geometry.triangular_number(row)
    return Position(row, col)</code></pre>
</details>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Position.col"><code class="name">var <span class="ident">col</span> : int</code></dt>
<dd>
<div class="desc"><p>Alias for field number 1</p></div>
</dd>
<dt id="pyramidtriangles.grid.geom.Position.id"><code class="name">var <span class="ident">id</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def id(self) -&gt; int:
    return Geometry.triangular_number(self.row) + self.col</code></pre>
</details>
</dd>
<dt id="pyramidtriangles.grid.geom.Position.row"><code class="name">var <span class="ident">row</span> : int</code></dt>
<dd>
<div class="desc"><p>Alias for field number 0</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Position.adjust"><code class="name flex">
<span>def <span class="ident">adjust</span></span>(<span>self, row: int = 0, col: int = 0) ‑> <a title="pyramidtriangles.grid.geom.Position" href="#pyramidtriangles.grid.geom.Position">Position</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def adjust(self, row: int = 0, col: int = 0) -&gt; Position:
    return Position(self.row + row, self.col + col)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="pyramidtriangles.grid.geom.Universe"><code class="flex name class">
<span>class <span class="ident">Universe</span></span>
<span>(</span><span>base: ForwardRef('int'), id: ForwardRef('int'))</span>
</code></dt>
<dd>
<div class="desc"><p>Universe is a DMX universe.</p>
<p>The base gives the universe ID of the first universe of a panel.
(This is used for the universe-length arithmetic.)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Universe(NamedTuple):
    &#34;&#34;&#34;
    Universe is a DMX universe.

    The base gives the universe ID of the first universe of a panel.
    (This is used for the universe-length arithmetic.)
    &#34;&#34;&#34;

    base: int
    id: int

    @property
    def size(self) -&gt; int:
        &#34;&#34;&#34;
        Gives the number of connected channels in each DMX universe.

        Every third universe in a panel is shorter. (Also, not all channels
        are visible; some correspond to the strip segments between rows.)
        &#34;&#34;&#34;

        return 512 if (self.id - (self.base - 1)) % 3 != 0 else (44 * 4)

    @property
    def next(self) -&gt; Universe:
        return Universe(self.base, self.id + 1)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.tuple</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="pyramidtriangles.grid.geom.Universe.base"><code class="name">var <span class="ident">base</span> : int</code></dt>
<dd>
<div class="desc"><p>Alias for field number 0</p></div>
</dd>
<dt id="pyramidtriangles.grid.geom.Universe.id"><code class="name">var <span class="ident">id</span> : int</code></dt>
<dd>
<div class="desc"><p>Alias for field number 1</p></div>
</dd>
<dt id="pyramidtriangles.grid.geom.Universe.next"><code class="name">var <span class="ident">next</span> : <a title="pyramidtriangles.grid.geom.Universe" href="#pyramidtriangles.grid.geom.Universe">Universe</a></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def next(self) -&gt; Universe:
    return Universe(self.base, self.id + 1)</code></pre>
</details>
</dd>
<dt id="pyramidtriangles.grid.geom.Universe.size"><code class="name">var <span class="ident">size</span> : int</code></dt>
<dd>
<div class="desc"><p>Gives the number of connected channels in each DMX universe.</p>
<p>Every third universe in a panel is shorter. (Also, not all channels
are visible; some correspond to the strip segments between rows.)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def size(self) -&gt; int:
    &#34;&#34;&#34;
    Gives the number of connected channels in each DMX universe.

    Every third universe in a panel is shorter. (Also, not all channels
    are visible; some correspond to the strip segments between rows.)
    &#34;&#34;&#34;

    return 512 if (self.id - (self.base - 1)) % 3 != 0 else (44 * 4)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pyramidtriangles.grid" href="index.html">pyramidtriangles.grid</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="pyramidtriangles.grid.geom.Address" href="#pyramidtriangles.grid.geom.Address">Address</a></code></h4>
<ul class="two-column">
<li><code><a title="pyramidtriangles.grid.geom.Address.first" href="#pyramidtriangles.grid.geom.Address.first">first</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Address.next" href="#pyramidtriangles.grid.geom.Address.next">next</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Address.offset" href="#pyramidtriangles.grid.geom.Address.offset">offset</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Address.range" href="#pyramidtriangles.grid.geom.Address.range">range</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Address.skip" href="#pyramidtriangles.grid.geom.Address.skip">skip</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Address.universe" href="#pyramidtriangles.grid.geom.Address.universe">universe</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pyramidtriangles.grid.geom.Coordinate" href="#pyramidtriangles.grid.geom.Coordinate">Coordinate</a></code></h4>
<ul class="">
<li><code><a title="pyramidtriangles.grid.geom.Coordinate.adjust" href="#pyramidtriangles.grid.geom.Coordinate.adjust">adjust</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Coordinate.from_pos" href="#pyramidtriangles.grid.geom.Coordinate.from_pos">from_pos</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Coordinate.pos" href="#pyramidtriangles.grid.geom.Coordinate.pos">pos</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Coordinate.x" href="#pyramidtriangles.grid.geom.Coordinate.x">x</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Coordinate.y" href="#pyramidtriangles.grid.geom.Coordinate.y">y</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pyramidtriangles.grid.geom.Geometry" href="#pyramidtriangles.grid.geom.Geometry">Geometry</a></code></h4>
<ul class="two-column">
<li><code><a title="pyramidtriangles.grid.geom.Geometry.apex" href="#pyramidtriangles.grid.geom.Geometry.apex">apex</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Geometry.cell_count" href="#pyramidtriangles.grid.geom.Geometry.cell_count">cell_count</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Geometry.height" href="#pyramidtriangles.grid.geom.Geometry.height">height</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Geometry.midpoint" href="#pyramidtriangles.grid.geom.Geometry.midpoint">midpoint</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Geometry.origin" href="#pyramidtriangles.grid.geom.Geometry.origin">origin</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Geometry.row_length" href="#pyramidtriangles.grid.geom.Geometry.row_length">row_length</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Geometry.rows" href="#pyramidtriangles.grid.geom.Geometry.rows">rows</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Geometry.triangular_number" href="#pyramidtriangles.grid.geom.Geometry.triangular_number">triangular_number</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Geometry.width" href="#pyramidtriangles.grid.geom.Geometry.width">width</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pyramidtriangles.grid.geom.Position" href="#pyramidtriangles.grid.geom.Position">Position</a></code></h4>
<ul class="">
<li><code><a title="pyramidtriangles.grid.geom.Position.adjust" href="#pyramidtriangles.grid.geom.Position.adjust">adjust</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Position.col" href="#pyramidtriangles.grid.geom.Position.col">col</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Position.from_id" href="#pyramidtriangles.grid.geom.Position.from_id">from_id</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Position.id" href="#pyramidtriangles.grid.geom.Position.id">id</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Position.row" href="#pyramidtriangles.grid.geom.Position.row">row</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pyramidtriangles.grid.geom.Universe" href="#pyramidtriangles.grid.geom.Universe">Universe</a></code></h4>
<ul class="">
<li><code><a title="pyramidtriangles.grid.geom.Universe.base" href="#pyramidtriangles.grid.geom.Universe.base">base</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Universe.id" href="#pyramidtriangles.grid.geom.Universe.id">id</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Universe.next" href="#pyramidtriangles.grid.geom.Universe.next">next</a></code></li>
<li><code><a title="pyramidtriangles.grid.geom.Universe.size" href="#pyramidtriangles.grid.geom.Universe.size">size</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>